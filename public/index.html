<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Dashboard | Gestor IA</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <aside class="sidebar">
        <div class="brand">
            <img src="logo.jpeg" alt="Logo" style="height: 45px;">
        </div>
        <nav class="nav-menu">
            <a class="nav-item active" onclick="showTab('home', this)"><span class="material-icons-round">space_dashboard</span><span>Dashboard</span></a>
            <a class="nav-item" onclick="showTab('agenda', this)"><span class="material-icons-round">calendar_month</span><span>Agenda</span></a>
            <a class="nav-item" onclick="showTab('chat', this)"><span class="material-icons-round">chat</span><span>Atendimento</span></a>
            <a class="nav-item" onclick="authSettings(this)"><span class="material-icons-round">tune</span><span>Configurações</span></a>
        </nav>
        <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid var(--border);">
            <a class="nav-item" style="color:var(--danger);" onclick="logout()"><span class="material-icons-round">power_settings_new</span><span>Reiniciar</span></a>
        </div>
    </aside>

    <main class="main">
        <header class="header">
            <div>
                <h2 id="page-title" style="font-weight:700;">Dashboard</h2>
                <p style="font-size:0.85rem; color:var(--text-muted);">Status do Sistema</p>
            </div>
            <div style="display:flex; align-items:center; gap:8px; padding:6px 12px; background:#ecfdf5; border-radius:20px; border:1px solid #d1fae5;">
                <div id="status-dot" style="width:8px; height:8px; border-radius:50%; background:var(--success);"></div>
                <span id="status-text" style="font-size:0.8rem; font-weight:600; color:var(--success);">Online</span>
            </div>
        </header>

        <div id="qr-overlay" class="qr-overlay">
            <h2 style="margin-bottom:20px;">Conectar WhatsApp</h2>
            <div class="qr-box" id="qr-box"></div>
            <p style="margin-top:20px; color:var(--text-muted);">Abra o WhatsApp > Aparelhos Conectados > Conectar</p>
        </div>

        <div id="view-home" class="view active" style="padding: 30px 40px;">
            <div class="grid-3">
                <div class="widget"><span class="widget-label">Agendamentos</span><div class="widget-value" id="total-apps">0</div></div>
                <div class="widget"><span class="widget-label">Mensagens Hoje</span><div class="widget-value" id="total-msgs">0</div></div>
                <div class="widget"><span class="widget-label">Status</span><div class="widget-value" style="color:var(--success);">Ativo</div></div>
            </div>
            <h3 style="margin-bottom:20px;">Próximos Clientes</h3>
            <div id="recent-list" class="agenda-grid"></div>
        </div>

        <div id="view-agenda" class="view" style="padding: 30px 40px;">
            <div class="agenda-layout">
                <div class="agenda-sidebar">
                    <button class="btn btn-primary" onclick="refreshData()"><span class="material-icons-round">refresh</span> Atualizar Agenda</button>
                    <div class="cal-widget">
                        <div class="cal-header"><span>Calendário</span></div>
                        <div class="cal-grid">
                            <span>D</span><span>S</span><span>T</span><span>Q</span><span>Q</span><span>S</span><span>S</span>
                            <span class="cal-day">1</span><span class="cal-day">2</span><span class="cal-day">3</span><span class="cal-day">4</span><span class="cal-day">5</span><span class="cal-day">6</span><span class="cal-day">7</span>
                            <span class="cal-day">8</span><span class="cal-day">9</span><span class="cal-day">10</span><span class="cal-day">11</span><span class="cal-day">12</span><span class="cal-day">13</span><span class="cal-day">14</span>
                            <span class="cal-day">15</span><span class="cal-day">16</span><span class="cal-day">17</span><span class="cal-day">18</span><span class="cal-day">19</span><span class="cal-day has-event">20</span><span class="cal-day">21</span>
                            <span class="cal-day">22</span><span class="cal-day">23</span><span class="cal-day">24</span><span class="cal-day has-event">25</span><span class="cal-day active">26</span><span class="cal-day">27</span><span class="cal-day">28</span>
                        </div>
                    </div>
                </div>
                <div class="timeline-container" id="agenda-timeline">
                    <div style="text-align:center; color:var(--text-muted); margin-top:50px;">Carregando agenda...</div>
                </div>
            </div>
        </div>

        <div id="view-chat" class="view" style="padding:0; overflow:hidden;">
            <div class="chat-layout">
                <div class="chat-sidebar">
                    <div class="chat-search"><input type="text" class="search-input" placeholder="Buscar conversa..." onkeyup="filterContacts(this.value)"></div>
                    <div class="contact-list" id="contact-list"></div>
                </div>
                <div class="chat-main" id="chat-main">
                    <div id="chat-header-bar" class="chat-header-bar" style="display:none;">
                        <button onclick="closeChatMobile()" class="mobile-only" style="border:none; background:none; font-size:1.5rem; margin-right:10px;">⬅️</button>
                        <div id="active-avatar" class="avatar">?</div>
                        <div>
                            <div id="active-name" style="font-weight:700;">Nome</div>
                            <div style="font-size:0.75rem; color:var(--text-muted);">Atendimento via Bot</div>
                        </div>
                    </div>
                    <div id="chat-feed" class="chat-messages">
                        <div class="empty-state"><span class="material-icons-round" style="font-size:4rem; color:#cbd5e1;">chat</span><p>Selecione uma conversa.</p></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-settings" class="view" style="padding: 30px 40px;">
            <h3 style="margin-bottom: 20px;">Configurações do Sistema</h3>
            <div class="settings-grid-layout">
                <div class="settings-card">
                    <div class="card-header"><span class="material-icons-round icon-bg">schedule</span><h4>Agenda e Horários</h4></div>
                    <div class="form-group-row">
                        <div class="form-group"><label>Abertura</label><input type="time" id="setting-inicio" class="input"></div>
                        <div class="form-group"><label>Fechamento</label><input type="time" id="setting-fim" class="input"></div>
                    </div>
                    <div class="form-group"><label>Duração Padrão (minutos)</label><input type="number" id="setting-duracao" class="input" placeholder="Ex: 40"></div>
                    <button class="btn btn-primary" onclick="saveSpecialSettings('agenda')">Salvar Horários</button>
                </div>

                <div class="settings-card" style="grid-row: span 2;">
                    <div class="card-header"><span class="material-icons-round icon-bg">psychology</span><h4>Inteligência Artificial</h4></div>
                    <div class="form-group">
                        <label>Personalidade e Regras (Prompt)</label>
                        <p class="help-text">Descreva como o bot deve agir, o nome da loja e as regras de negócio.</p>
                        <textarea id="setting-prompt" class="input textarea-large" placeholder="Ex: Você é a atendente virtual..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveSpecialSettings('ia')">Atualizar Cérebro</button>
                </div>

                <div class="settings-card">
                    <div class="card-header"><span class="material-icons-round icon-bg">lock</span><h4>Segurança (Whitelist)</h4></div>
                    <div class="form-group">
                        <label>Números Permitidos</label>
                        <p class="help-text">Separe por vírgula. Deixe vazio para liberar p/ todos.<br>Ex: 5511999999999</p>
                        <textarea id="setting-numeros" class="input textarea-medium" placeholder="55..."></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="saveSpecialSettings('seguranca')">Salvar Lista</button>
                </div>

                <div class="settings-card">
                    <div class="card-header"><span class="material-icons-round icon-bg">list</span><h4>Outras Informações</h4></div>
                    <p class="help-text">Adicione preços, endereços ou respostas rápidas.</p>
                    <div class="form-group"><label>Nome da Chave</label><input id="cfg-key" class="input" placeholder="Ex: pix, endereco"></div>
                    <div class="form-group"><label>Resposta Completa</label><textarea id="cfg-val" class="input textarea-medium" placeholder="Texto..."></textarea></div>
                    <div class="action-buttons">
                        <button id="btn-save-generic" class="btn btn-secondary" onclick="saveGenericConfig()"><span class="material-icons-round">add</span> Adicionar</button>
                        <button id="btn-cancel-edit" class="btn btn-danger" onclick="cancelEdit()" style="display: none;"><span class="material-icons-round">close</span></button>
                    </div>
                    <div id="config-list" class="mini-list"></div>
                </div>

                <div class="settings-card">
                    <div class="card-header"><span class="material-icons-round icon-bg danger">power_settings_new</span><h4>Zona de Perigo</h4></div>
                    <button class="btn btn-danger" onclick="disconnectWhatsapp()">Desconectar WhatsApp</button>
                </div>
            </div>
        </div>
    </main>

    <div class="toast" id="toast">Salvo!</div>
    <script src="/socket.io/socket.io.js"></script>
    <script src="script.js"></script>
</body>
</html>